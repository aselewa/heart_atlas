<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Heart eQTLs</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">HeartAtlas</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Heart eQTLs</h1>

</div>


<div id="exploration-gtex-enrichment" class="section level3">
<h3>Exploration: GTEx enrichment</h3>
<p>GTEx has eQTL data for n = 495 individuals for heart tissue (left ventricle.) We hypothesize that the cardiomyocyte (CM) regulatory elements are enriched with heart eQTLs. We use Torus to perform this enrichment analysis. We plot the log2 enrichment result below.</p>
<pre class="r"><code>enrich.df &lt;- read.delim(&#39;../eQTL_enrich/results/torus_celltypes_combined.enrichment&#39;, header=F, sep=&quot;&quot;)

ggplot(enrich.df, aes(x=V2, y=V1)) + geom_point() + geom_errorbar(aes(xmin=V3, xmax=V4), colour=&quot;black&quot;, width=.1) + ggClean() +
  xlab(&#39;log2 Enrichment&#39;) + ylab(&#39;Cell Type&#39;) + geom_vline(xintercept = 0, col=&#39;red&#39;, linetype = &quot;longdash&quot;) + ggtitle(&#39;Enrichment of ArchR DA Peaks&#39;)</code></pre>
<p><img src="eqtl_enrichment_files/figure-html/gtex1-1.png" width="672" /></p>
</div>
<div id="heart-eqtl-finemapping" class="section level3">
<h3>Heart eQTL Finemapping</h3>
<p>Here we focus on eQTLs that are finemapped with a posterior probability of association &gt; 0.8. There are approximately 2,300 such SNPs.</p>
<pre class="r"><code>eqtl.pips &lt;- read.delim(&#39;../eQTL_enrich/gtex_finemapping/GTEx_v8_finemapping_DAPG/SNP_PIP_df.txt&#39;, sep=&#39;\t&#39;, header = T)
eqtl.pips &lt;- eqtl.pips[eqtl.pips$PIP &gt; 0.8,]
eqtl.gr &lt;- snpIDtoGR(eqtl.pips$SNP)
eqtl.gr$pip &lt;- eqtl.pips$PIP
eqtl.gr$SNP &lt;- eqtl.pips$SNP

rand.snps &lt;- readLines(&#39;../matched_SNPs/eQTL_top_pip_hg19_5batches/snpsnap_match_hg38.txt&#39;)
rand.gr &lt;- StringToGR(rand.snps)
rand.gr &lt;- rand.gr[seqnames(rand.gr) %in% paste0(&quot;chr&quot;,1:22),]
seqlevels(rand.gr) &lt;-  paste0(&quot;chr&quot;,1:22)
rand.gr$SNP &lt;- paste0(seqnames(rand.gr),&#39;_&#39;,start(rand.gr))</code></pre>
<p>Get tissue activity of each eQTL from <a href="https://zenodo.org/record/3727189" class="uri">https://zenodo.org/record/3727189</a> (GTEx v8 paper)</p>
<pre class="r"><code>eqtl.lfsr &lt;- suppressMessages(vroom::vroom(&#39;../eQTL_enrich/broadinstitute-gtex-v8-a014b43/data/Fig6C_all_top.z_lfsr.sig.pruned.txt.gz&#39;))
tissues.active &lt;- rowSums(eqtl.lfsr[,3:ncol(eqtl.lfsr)] &lt; 0.01, na.rm = T)
eqtl.ntissues &lt;- data.frame(eqtl=eqtl.lfsr$variant, ntissues=tissues.active) %&gt;% group_by(eqtl) %&gt;% summarise(mean_tissues = mean(ntissues))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<p>Add tissue activity to our eQTL genomic ranges object</p>
<pre class="r"><code>eqtl.gr$ntissues.active &lt;- eqtl.ntissues$mean_tissues[match(eqtl.gr$SNP, eqtl.ntissues$eqtl)]
eqtl.gr.low &lt;- eqtl.gr[which(eqtl.gr$ntissues.active&lt;=10),]
eqtl.gr.high &lt;- eqtl.gr[which(eqtl.gr$ntissues.active&gt;=30),]</code></pre>
<p>Split ventrical cardiomyocyte peaks into cell-type specific and into shared.</p>
<pre class="r"><code>satac &lt;- suppressMessages(loadArchRProject(&#39;../ArchR/ArchR_heart/&#39;, showLogo = F))
union.set &lt;- getPeakSet(satac)
ventCalls &lt;- readRDS(&#39;../ArchR/ArchR_heart/PeakCalls/Vent..CM-reproduciblePeaks.gr.rds&#39;)
markers &lt;- readRDS(&#39;../ArchR/ArchR_heart/PeakCalls/DA_MARKERS_FDRP_1_log2FC_1.rds&#39;)

vent.specific &lt;- markers$`Vent. CM`
hits &lt;- GenomicRanges::findOverlaps(query = vent.specific, subject = ventCalls)
vent.shared &lt;- ventCalls[-subjectHits(hits),]

hits &lt;- GenomicRanges::findOverlaps(query = ventCalls, subject = union.set)
non.cm.peaks &lt;- union.set[-subjectHits(hits)]</code></pre>
<p>There are 48,012 cell-type specific peaks, and ~97,500 that are shared CM peaks.</p>
<p>Overlap generic genomic annotations with top eQTLs</p>
<pre class="r"><code>disjoint.annots &lt;- readRDS(&#39;../eQTL_enrich/annotations/hg38_disjoint_annotations.gr.rds&#39;)</code></pre>
<p>Overlap eQTLs with exons, introns, etc.</p>
<pre class="r"><code>eqtl.genome.dist.df &lt;- SNPGenomeDistrib(snp.gr = eqtl.gr, genomic.annots = disjoint.annots)
#eqtl.dist.low.df &lt;- SNPGenomeDistrib(snp.gr = eqtl.gr.low, genomic.annots = disjoint.annots)
#eqtl.dist.high.df &lt;- SNPGenomeDistrib(snp.gr = eqtl.gr.high, genomic.annots = disjoint.annots)
rand.genome.dist.df &lt;- SNPGenomeDistrib(snp.gr = rand.gr, genomic.annots = disjoint.annots)</code></pre>
<p>Distribution of top eQTLs across the genome. Most are in intronic regions which is reasonable given they are cis-eQTLs. About 6% are in the cell-type specific CM peaks, and ~24% are in the shared CM peaks (note that these peaks are disjoint sets).</p>
<pre class="r"><code>genomic.dist.df &lt;- Reduce(rbind, list(rand.genome.dist.df, eqtl.genome.dist.df))
genomic.dist.df$SNPs &lt;- c(rep(&quot;Random SNPs&quot;, nrow(rand.genome.dist.df)),
                          rep(&quot;eQTLs&quot;, nrow(eqtl.genome.dist.df)))

eqtl.union.set &lt;- join_overlap_list(gr.list = list(&quot;Union Set&quot;=union.set), X = eqtl.gr)
genomic.dist.df[&quot;Union eQTL&quot;,] &lt;- c(100*length(eqtl.union.set$`Union Set`)/length(eqtl.gr), &quot;Union Peak Set&quot;, &quot;eQTLs&quot;)
rand.union.set &lt;- join_overlap_list(gr.list = list(&quot;Union Set&quot;=union.set), X = rand.gr)
genomic.dist.df[&quot;Union Random&quot;,] &lt;- c(100*length(rand.union.set$`Union Set`)/length(rand.gr), &quot;Union Peak Set&quot;, &quot;Random SNPs&quot;)

genomic.dist.df$freq &lt;- as.numeric(genomic.dist.df$freq)</code></pre>
<p>Plot distributions</p>
<pre class="r"><code>genomic.dist.df$category &lt;- factor(genomic.dist.df$category, levels = rev(c(&quot;Union Peak Set&quot;,&quot;exon&quot;,&quot;intronic&quot;,&quot;UTR&quot;,&quot;promoter&quot;,&quot;intergenic&quot;)))
ggplot(genomic.dist.df, aes(y=category, x=freq, fill=SNPs)) + 
  geom_bar(stat=&quot;identity&quot;, position=&quot;dodge&quot;) + ggClean() + xlab(&quot;Percent SNPs&quot;) + ylab(&quot;Category&quot;) + ggtitle(&quot;Distribution of Top eQTLs&quot;) + 
  geom_hline(yintercept = 5.5, linetype=&quot;dashed&quot;) + scale_fill_manual(values = c(&quot;black&quot;,&quot;gray&quot;))</code></pre>
<p><img src="eqtl_enrichment_files/figure-html/unnamed-chunk-361-1.png" width="672" /></p>
<p>Overlap scATAC-seq peaks with top eQTLs</p>
<pre class="r"><code>peaks.gr.list &lt;- list(&quot;CM Specific Peaks&quot;=vent.specific, &quot;CM Shared Peaks&quot;=vent.shared, &quot;Non-CM Peaks&quot;=non.cm.peaks)

#peaks.eqtls &lt;- join_overlap_list(gr.list = peaks.gr.list, X = eqtl.gr)
peaks.eqtls.low &lt;- join_overlap_list(gr.list = peaks.gr.list, X = eqtl.gr.low)
peaks.eqtls.high &lt;- join_overlap_list(gr.list = peaks.gr.list, X = eqtl.gr.high)
#peaks.random &lt;- join_overlap_list(gr.list = peaks.gr.list, X = rand.gr)</code></pre>
<pre class="r"><code>#freq &lt;- sapply(peaks.eqtls, FUN = function(x){100*length(x)/length(eqtl.gr)})
#eqtl.dist.df &lt;- data.frame(freq=freq, category=names(freq))

freq &lt;- sapply(peaks.eqtls.low, FUN = function(x){100*length(x)/length(eqtl.gr.low)})
eqtl.dist.low.df &lt;- data.frame(freq=freq, category=names(freq))

freq &lt;- sapply(peaks.eqtls.high, FUN = function(x){100*length(x)/length(eqtl.gr.high)})
eqtl.dist.high.df &lt;- data.frame(freq=freq, category=names(freq))

#freq &lt;- sapply(peaks.random, FUN = function(x){100*length(x)/length(rand.gr)})
#rand.dist.df &lt;- data.frame(freq=freq, category=names(freq))</code></pre>
<pre class="r"><code>peak.dist.df &lt;- Reduce(rbind, list(eqtl.dist.low.df, eqtl.dist.high.df))
peak.dist.df$SNPs &lt;- c(rep(&quot;eQTLs (nTissue &lt; 10)&quot;,nrow(eqtl.dist.low.df)), 
                       rep(&quot;eQTLs (nTissue &gt; 30)&quot;,nrow(eqtl.dist.high.df)))</code></pre>
<pre class="r"><code>peak.dist.df$category &lt;- factor(peak.dist.df$category, levels = rev(c(&quot;Non-CM Peaks&quot;,&quot;CM Shared Peaks&quot;, &quot;CM Specific Peaks&quot;)))
ggplot(peak.dist.df, aes(y=category, x=freq, fill=SNPs)) + 
  geom_bar(stat=&quot;identity&quot;, position=&quot;dodge&quot;) + ggClean() + xlab(&quot;Percent&quot;) + ylab(&quot;Category&quot;) + ggtitle(&quot;Distribution of Top eQTLs&quot;) + 
  geom_hline(yintercept = 5.5, linetype=&quot;dashed&quot;) + scale_fill_manual(values = c(&quot;blue&quot;,&quot;red&quot;))</code></pre>
<p><img src="eqtl_enrichment_files/figure-html/unnamed-chunk-365-1.png" width="672" /></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
